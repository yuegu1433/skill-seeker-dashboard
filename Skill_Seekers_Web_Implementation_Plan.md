# Skill Seekers Webç®¡ç†ç³»ç»Ÿå®æ–½æ–¹æ¡ˆ (MinIOç‰ˆæœ¬)

## é¡¹ç›®æ¦‚è¿°

åŸºäº skill_seekers-2.7.4 CLI å·¥å…·ï¼Œè®¾è®¡å¹¶å®ç°å®Œæ•´çš„Webç®¡ç†ç³»ç»Ÿï¼Œæ»¡è¶³ã€ŠCOMPLETE_REQUIREMENTS.mdã€‹ä¸­çš„æ‰€æœ‰åŠŸèƒ½éœ€æ±‚ã€‚

### ç›®æ ‡

- âœ… æ„å»ºå¯è§†åŒ–çš„æŠ€èƒ½ç®¡ç†ç•Œé¢
- âœ… æä¾›å®æ—¶åˆ›å»ºè¿›åº¦è·Ÿè¸ª
- âœ… æ”¯æŒæŠ€èƒ½æ–‡ä»¶åœ¨çº¿ç¼–è¾‘
- âœ… å®ç°å®Œæ•´çš„æŠ€èƒ½ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… æ”¯æŒ4ä¸ªLLMå¹³å°ï¼ˆClaudeã€Geminiã€OpenAIã€Markdownï¼‰
- âœ… ä½¿ç”¨MinIOå¯¹è±¡å­˜å‚¨å®ç°é«˜å¯ç”¨å­˜å‚¨æ–¹æ¡ˆ
- âœ… ç®€åŒ–æ¶æ„ï¼šæ— éœ€ç”¨æˆ·ç®¡ç†ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½å¼€å‘

### å¼€å‘è¯´æ˜

**ç”¨æˆ·ç®¡ç†**ï¼šå¼€å‘é˜¶æ®µä¸è€ƒè™‘ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼Œé‡‡ç”¨å•ç§Ÿæˆ·æ¶æ„ã€‚æ‰€æœ‰åŠŸèƒ½å¯¹æ‰€æœ‰è®¿é—®è€…å¼€æ”¾ï¼Œæ— éœ€æ³¨å†Œ/ç™»å½•ã€‚

**ä¼˜åŠ¿**ï¼š
- ç®€åŒ–ç³»ç»Ÿæ¶æ„ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
- é™ä½å¼€å‘å¤æ‚åº¦
- åŠ å¿«MVPäº§å“äº¤ä»˜
- å‡å°‘å®‰å…¨é£é™©é¢
- é™ä½è¿ç»´æˆæœ¬

### æŠ€æœ¯æ ˆé€‰æ‹©

- **åç«¯**ï¼šFastAPI + PostgreSQL + Redis + Celery
- **å‰ç«¯**ï¼šReact 18 + TypeScript + Ant Design
- **å®æ—¶é€šä¿¡**ï¼šWebSocket
- **éƒ¨ç½²**ï¼šDocker + Docker Compose + Nginx
- **å­˜å‚¨**ï¼šMinIOå¯¹è±¡å­˜å‚¨ + PostgreSQLå…ƒæ•°æ®ï¼ˆç¬¦åˆéœ€æ±‚3.1çš„å­˜å‚¨æ¶æ„ï¼‰

## ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Webç®¡ç†ç•Œé¢ (React)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ æŠ€èƒ½åˆ—è¡¨    â”‚ â”‚ åˆ›å»ºå‘å¯¼    â”‚ â”‚ æ–‡ä»¶ç¼–è¾‘å™¨  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   FastAPIåç«¯    â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚ æŠ€èƒ½API     â”‚ â”‚
                    â”‚ â”‚ é…ç½®API     â”‚ â”‚
                    â”‚ â”‚ æ–‡ä»¶API     â”‚ â”‚
                    â”‚ â”‚ æ—¥å¿—API     â”‚ â”‚
                    â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  ä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿ     â”‚
                    â”‚  (Celery+Redis)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  skill-seekers   â”‚
                    â”‚     CLIå·¥å…·      â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚ æ–‡æ¡£æŠ“å–    â”‚ â”‚
                    â”‚ â”‚ GitHubåˆ†æ  â”‚ â”‚
                    â”‚ â”‚ AIå¢å¼º     â”‚ â”‚
                    â”‚ â”‚ å¤šå¹³å°æ‰“åŒ…  â”‚ â”‚
                    â””â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     Nginxä»£ç†        â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚  â”‚ é™æ€æ–‡ä»¶æœåŠ¡  â”‚ â”‚
                    â”‚  â”‚ APIè½¬å‘      â”‚ â”‚
                    â”‚  â”‚ WebSocket   â”‚ â”‚
                    â”‚  â”‚ MinIOä»£ç†   â”‚ â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MinIOå¯¹è±¡å­˜å‚¨     â”‚
                    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
                    â”‚ â”‚ skillsæ¡¶   â”‚ â”‚
                    â”‚ â”‚ cacheæ¡¶    â”‚ â”‚
                    â”‚ â”‚ archivesæ¡¶ â”‚ â”‚
                    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
```

## MinIO å­˜å‚¨ä¼˜åŠ¿

### 1. é«˜å¯æ‰©å±•æ€§
- **å¯¹è±¡å­˜å‚¨**ï¼šæ— é™æ°´å¹³æ‰©å±•ï¼Œæ”¯æŒEBçº§æ•°æ®å­˜å‚¨
- **åˆ†å¸ƒå¼æ¶æ„**ï¼šå¤šèŠ‚ç‚¹éƒ¨ç½²ï¼Œæ•°æ®è‡ªåŠ¨å¤åˆ¶
- **è´Ÿè½½å‡è¡¡**ï¼šè‡ªåŠ¨è´Ÿè½½åˆ†æ•£ï¼Œæé«˜å¹¶å‘æ€§èƒ½

### 2. é«˜å¯ç”¨æ€§
- **æ•°æ®å†—ä½™**ï¼šå¤šå‰¯æœ¬å­˜å‚¨ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±
- **æ•…éšœè½¬ç§»**ï¼šèŠ‚ç‚¹æ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢ï¼Œä¿è¯æœåŠ¡è¿ç»­æ€§
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šæ”¯æŒå¯¹è±¡ç‰ˆæœ¬ç®¡ç†ï¼Œé˜²èŒƒè¯¯åˆ é™¤

### 3. æ€§èƒ½ä¼˜åŒ–
- **å¹¶è¡Œå¤„ç†**ï¼šæ”¯æŒå¤šçº¿ç¨‹ä¸Šä¼ ä¸‹è½½
- **ç¼“å­˜å‹å¥½**ï¼šä¸CDNé›†æˆï¼ŒåŠ é€Ÿæ–‡ä»¶è®¿é—®
- **å‹ç¼©å­˜å‚¨**ï¼šè‡ªåŠ¨å‹ç¼©ï¼Œå‡å°‘å­˜å‚¨æˆæœ¬

### 4. å®‰å…¨æ€§
- **è®¿é—®æ§åˆ¶**ï¼šç®€åŒ–è®¿é—®æ§åˆ¶ï¼ˆå¼€å‘é˜¶æ®µæ— è®¤è¯ï¼‰
- **æ•°æ®åŠ å¯†**ï¼šä¼ è¾“å’Œé™æ€æ•°æ®åŠ å¯†
- **å®¡è®¡æ—¥å¿—**ï¼šå®Œæ•´çš„æ“ä½œè®°å½•å’Œæ—¥å¿—

### 5. å•ç§Ÿæˆ·æ¶æ„
- **æ— éœ€ç”¨æˆ·ç®¡ç†**ï¼šæ‰€æœ‰è®¿é—®è€…å…±äº«åŒä¸€å¥—æ•°æ®å’ŒåŠŸèƒ½
- **ç®€åŒ–éƒ¨ç½²**ï¼šå•å®ä¾‹éƒ¨ç½²ï¼Œæ— éœ€å¤æ‚çš„ç”¨æˆ·æƒé™ç³»ç»Ÿ
- **é™ä½å¤æ‚åº¦**ï¼šä¸“æ³¨äºæ ¸å¿ƒæŠ€èƒ½ç®¡ç†åŠŸèƒ½å¼€å‘

## è¯¦ç»†å®æ–½æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŸºç¡€è®¾æ–½ï¼ˆ3-4å‘¨ï¼‰

#### 1.1 PostgreSQL æ•°æ®åº“è®¾è®¡

```sql
-- æŠ€èƒ½ä¸»è¡¨
CREATE TABLE skills (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    name VARCHAR(100) NOT NULL,
    description TEXT,
    platform VARCHAR(20) NOT NULL CHECK (platform IN ('claude', 'gemini', 'openai', 'markdown')),
    status VARCHAR(20) NOT NULL DEFAULT 'creating' CHECK (status IN ('creating', 'completed', 'failed', 'enhancing')),
    source_type VARCHAR(20) NOT NULL CHECK (source_type IN ('github', 'web', 'upload', 'multi')),
    metadata JSONB,
    config JSONB,
    -- MinIOå­˜å‚¨ç›¸å…³å­—æ®µ
    storage_bucket VARCHAR(50) DEFAULT 'skillseekers-skills',
    storage_prefix VARCHAR(200),
    file_count INTEGER DEFAULT 0,
    total_size_bytes BIGINT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºä»»åŠ¡è¡¨ï¼ˆæ”¯æŒå®æ—¶è¿›åº¦ï¼‰
CREATE TABLE skill_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    skill_id UUID REFERENCES skills(id) ON DELETE CASCADE,
    task_type VARCHAR(20) NOT NULL CHECK (task_type IN ('scrape', 'build', 'enhance', 'package')),
    status VARCHAR(20) NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'running', 'completed', 'failed', 'cancelled')),
    progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
    logs TEXT,
    error_details TEXT,
    started_at TIMESTAMP,
    completed_at TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- æŠ€èƒ½æ–‡ä»¶è¡¨ï¼ˆå­˜å‚¨MinIOå¯¹è±¡ä¿¡æ¯ï¼‰
CREATE TABLE skill_files (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    skill_id UUID REFERENCES skills(id) ON DELETE CASCADE,
    object_name VARCHAR(500) NOT NULL, -- MinIOå¯¹è±¡å
    file_path VARCHAR(500) NOT NULL, -- é€»è¾‘è·¯å¾„
    file_type VARCHAR(20) NOT NULL CHECK (file_type IN ('skill_file', 'reference', 'config', 'metadata', 'log')),
    file_size BIGINT,
    content_type VARCHAR(100),
    checksum VARCHAR(64), -- æ–‡ä»¶æ ¡éªŒå’Œ
    is_public BOOLEAN DEFAULT FALSE, -- æ˜¯å¦å…¬å¼€è®¿é—®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å¹³å°åŒ…æ–‡ä»¶è¡¨
CREATE TABLE platform_packages (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    skill_id UUID REFERENCES skills(id) ON DELETE CASCADE,
    platform VARCHAR(20) NOT NULL,
    object_name VARCHAR(500), -- MinIOå¯¹è±¡å
    package_size BIGINT,
    checksum VARCHAR(64),
    download_url TEXT, -- é¢„ç­¾åä¸‹è½½URL
    expires_at TIMESTAMP, -- URLè¿‡æœŸæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_skills_status ON skills(status);
CREATE INDEX idx_skills_platform ON skills(platform);
CREATE INDEX idx_skills_created_at ON skills(created_at DESC);
CREATE INDEX idx_skill_tasks_skill_id ON skill_tasks(skill_id);
CREATE INDEX idx_skill_files_skill_id ON skill_files(skill_id);
CREATE INDEX idx_skill_files_object_name ON skill_files(object_name);
CREATE INDEX idx_platform_packages_skill_id ON platform_packages(skill_id);
```

### ç¬¬äºŒé˜¶æ®µï¼šReact Webç•Œé¢ï¼ˆ6-8å‘¨ï¼‰

#### 2.1 æŠ€èƒ½å¡ç‰‡ç»„ä»¶ï¼ˆæ”¯æŒMinIOï¼‰

```typescript
// src/components/SkillCard.tsx
import React from 'react';
import { Card, Button, Tag, Progress, Dropdown, Space, Tooltip } from 'antd';
import { DownloadOutlined, EditOutlined, DeleteOutlined, EyeOutlined, CloudServerOutlined } from '@ant-design/icons';
import type { MenuProps } from 'antd';

interface SkillCardProps {
  skill: Skill;
  onViewDetails: (skill: Skill) => void;
  onDelete: (skill: Skill) => void;
  onEdit: (skill: Skill) => void;
  onDownload: (skill: Skill, platform: Platform) => void;
}

const SkillCard: React.FC<SkillCardProps> = ({
  skill,
  onViewDetails,
  onDelete,
  onEdit,
  onDownload
}) => {
  const getPlatformColor = (platform: string) => {
    const colors = {
      claude: '#D97706',
      gemini: '#1A73E8',
      openai: '#10A37F',
      markdown: '#6B7280'
    };
    return colors[platform] || '#6B7280';
  };

  const getStatusColor = (status: string) => {
    const colors = {
      creating: '#1890FF',
      completed: '#52C41A',
      failed: '#FF4D4F',
      enhancing: '#FAAD14'
    };
    return colors[status] || '#D9D9D9';
  };

  // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
  const formatFileSize = (bytes: number): string => {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
  };

  const downloadMenuItems: MenuProps['items'] = [
    {
      key: 'claude',
      label: 'Claude AI',
      onClick: () => onDownload(skill, 'claude')
    },
    {
      key: 'gemini',
      label: 'Google Gemini',
      onClick: () => onDownload(skill, 'gemini')
    },
    {
      key: 'openai',
      label: 'OpenAI ChatGPT',
      onClick: () => onDownload(skill, 'openai')
    },
    {
      key: 'markdown',
      label: 'Generic Markdown',
      onClick: () => onDownload(skill, 'markdown')
    }
  ];

  return (
    <Card
      hoverable
      className="skill-card"
      cover={
        <div
          className="skill-card-header"
          style={{
            backgroundColor: getPlatformColor(skill.platform),
            color: 'white',
            padding: '16px'
          }}
        >
          <div className="flex justify-between items-center">
            <div className="flex items-center space-x-2">
              <PlatformIcon platform={skill.platform} />
              <span className="font-medium capitalize">{skill.platform}</span>
              <Tooltip title="å­˜å‚¨åœ¨MinIOå¯¹è±¡å­˜å‚¨ä¸­">
                <CloudServerOutlined />
              </Tooltip>
            </div>
            <Tag color={getStatusColor(skill.status)}>
              {skill.status}
            </Tag>
          </div>
        </div>
      }
      actions={[
        <Button
          type="text"
          icon={<EyeOutlined />}
          onClick={() => onViewDetails(skill)}
        >
          æŸ¥çœ‹
        </Button>,
        <Button
          type="text"
          icon={<EditOutlined />}
          onClick={() => onEdit(skill)}
        >
          ç¼–è¾‘
        </Button>,
        <Dropdown menu={{ items: downloadMenuItems }} placement="bottomRight">
          <Button type="text" icon={<DownloadOutlined />}>
            ä¸‹è½½
          </Button>
        </Dropdown>,
        <Button
          type="text"
          danger
          icon={<DeleteOutlined />}
          onClick={() => onDelete(skill)}
        >
          åˆ é™¤
        </Button>
      ]}
    >
      <Card.Meta
        title={skill.name}
        description={skill.description}
      />

      <div className="skill-progress mt-4">
        <div className="flex justify-between text-sm text-gray-500 mb-2">
          <span>åˆ›å»ºè¿›åº¦</span>
          <span>{skill.progress || 0}%</span>
        </div>
        <Progress
          percent={skill.progress || 0}
          showInfo={false}
          strokeColor={getPlatformColor(skill.platform)}
        />
      </div>

      <div className="skill-meta mt-4 text-sm text-gray-500 space-y-1">
        <div className="flex justify-between">
          <span>åˆ›å»ºäº: {formatDate(skill.created_at)}</span>
          <Tooltip title="å­˜å‚¨åœ¨MinIOä¸­">
            <CloudServerOutlined />
          </Tooltip>
        </div>
        <div className="flex justify-between">
          <span>æ¥æº: {skill.source_type}</span>
          <span>{skill.file_count} æ–‡ä»¶</span>
        </div>
        <div className="flex justify-between">
          <span>å¤§å°:</span>
          <span>{formatFileSize(skill.total_size_bytes || 0)}</span>
        </div>
      </div>
    </Card>
  );
};

export default SkillCard;
```

### ç¬¬ä¸‰é˜¶æ®µï¼šMinIO å­˜å‚¨ç³»ç»Ÿå‡çº§ï¼ˆ4-5å‘¨ï¼‰

#### 3.1 MinIO å­˜å‚¨ç®¡ç†å™¨å®ç°

```python
# src/storage/manager.py
import json
import io
from typing import Dict, Any, Optional, List
from datetime import datetime, timedelta
import uuid
from minio import Minio
from minio.error import S3Error
from minio.commonconfig import CopySource

class SkillStorageManager:
    """åŸºäºMinIOçš„æŠ€èƒ½å­˜å‚¨ç®¡ç†å™¨ï¼ˆå®ç°éœ€æ±‚ä¸­çš„å­˜å‚¨æ¶æ„ï¼‰"""

    def __init__(self,
                 endpoint: str = "minio:9000",
                 access_key: str = "minioadmin",
                 secret_key: str = "minioadmin",
                 secure: bool = False):
        """
        åˆå§‹åŒ–MinIOå®¢æˆ·ç«¯

        Args:
            endpoint: MinIOæœåŠ¡å™¨åœ°å€
            access_key: è®¿é—®å¯†é’¥
            secret_key: ç§˜å¯†å¯†é’¥
            secure: æ˜¯å¦ä½¿ç”¨HTTPSï¼ˆå¼€å‘é˜¶æ®µä½¿ç”¨HTTPï¼‰
        """
        self.client = Minio(
            endpoint,
            access_key=access_key,
            secret_key=secret_key,
            secure=secure
        )

        # åˆ›å»ºå­˜å‚¨æ¡¶
        self.buckets = {
            "skills": "skillseekers-skills",
            "temp": "skillseekers-temp",
            "cache": "skillseekers-cache",
            "archives": "skillseekers-archives"
        }

        self._ensure_buckets()

    def _ensure_buckets(self):
        """ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„å­˜å‚¨æ¡¶å­˜åœ¨"""
        for bucket_name in self.buckets.values():
            if not self.client.bucket_exists(bucket_name):
                self.client.make_bucket(bucket_name)

    def create_skill_storage(self, skill_id: str) -> 'SkillStorage':
        """åˆ›å»ºæŠ€èƒ½å­˜å‚¨ç»“æ„ï¼ˆä½¿ç”¨MinIOå¯¹è±¡å‰ç¼€æ¨¡æ‹Ÿç›®å½•ï¼‰"""
        return SkillStorage(self.client, self.buckets, skill_id)

    def save_metadata(self, skill_id: str, metadata: Dict[str, Any]):
        """ä¿å­˜æŠ€èƒ½å…ƒæ•°æ®åˆ°MinIO"""
        storage = self.create_skill_storage(skill_id)
        metadata_json = json.dumps(metadata, indent=2, ensure_ascii=False)
        storage.upload_file(
            object_name="metadata.json",
            file_data=metadata_json.encode('utf-8'),
            content_type="application/json"
        )

    def save_config(self, skill_id: str, config: Dict[str, Any]):
        """ä¿å­˜æŠ€èƒ½é…ç½®åˆ°MinIO"""
        storage = self.create_skill_storage(skill_id)
        config_json = json.dumps(config, indent=2, ensure_ascii=False)
        storage.upload_file(
            object_name="config.json",
            file_data=config_json.encode('utf-8'),
            content_type="application/json"
        )

    def update_status(self, skill_id: str, status: Dict[str, Any]):
        """æ›´æ–°æŠ€èƒ½çŠ¶æ€"""
        storage = self.create_skill_storage(skill_id)
        status_data = {
            "updated_at": datetime.utcnow().isoformat(),
            **status
        }
        status_json = json.dumps(status_data, indent=2)
        storage.upload_file(
            object_name="status.json",
            file_data=status_json.encode('utf-8'),
            content_type="application/json"
        )

    def save_creation_logs(self, skill_id: str, logs_data: Dict[str, Any]):
        """ä¿å­˜åˆ›å»ºè¿‡ç¨‹æ—¥å¿—ï¼ˆç¬¦åˆéœ€æ±‚2.3.3ï¼‰"""
        storage = self.create_skill_storage(skill_id)

        # ä¿å­˜ä¸åŒæ ¼å¼çš„æ—¥å¿—åˆ°logs/å‰ç¼€
        if "raw_logs" in logs_data:
            storage.upload_file(
                object_name="logs/creation.log",
                file_data=logs_data["raw_logs"].encode('utf-8'),
                content_type="text/plain"
            )

        if "markdown_report" in logs_data:
            storage.upload_file(
                object_name="logs/creation_report.md",
                file_data=logs_data["markdown_report"].encode('utf-8'),
                content_type="text/markdown"
            )

        if "timeline_json" in logs_data:
            timeline_json = json.dumps(logs_data["timeline_json"], indent=2)
            storage.upload_file(
                object_name="logs/timeline.json",
                file_data=timeline_json.encode('utf-8'),
                content_type="application/json"
            )

        if "config_snapshot" in logs_data:
            config_snapshot = json.dumps(logs_data["config_snapshot"], indent=2)
            storage.upload_file(
                object_name="logs/config_snapshot.json",
                file_data=config_snapshot.encode('utf-8'),
                content_type="application/json"
            )

    def upload_skill_file(self, skill_id: str, file_path: str, file_data: bytes, content_type: str = "application/octet-stream"):
        """ä¸Šä¼ æŠ€èƒ½æ–‡ä»¶"""
        storage = self.create_skill_storage(skill_id)
        object_name = f"skill_files/{file_path}"
        storage.upload_file(object_name, file_data, content_type)

    def download_skill_file(self, skill_id: str, file_path: str) -> bytes:
        """ä¸‹è½½æŠ€èƒ½æ–‡ä»¶"""
        storage = self.create_skill_storage(skill_id)
        object_name = f"skill_files/{file_path}"
        return storage.download_file(object_name)

    def delete_skill(self, skill_id: str):
        """åˆ é™¤æŠ€èƒ½åŠæ‰€æœ‰æ–‡ä»¶"""
        storage = self.create_skill_storage(skill_id)
        storage.delete_all_files()

    def list_skills(self) -> List[str]:
        """åˆ—å‡ºæ‰€æœ‰æŠ€èƒ½ID"""
        try:
            objects = self.client.list_objects(
                self.buckets["skills"],
                prefix="skills/",
                recursive=True
            )
            skill_ids = set()
            for obj in objects:
                # ä»å¯¹è±¡è·¯å¾„æå–æŠ€èƒ½ID
                # æ ¼å¼: skills/{skill_id}/metadata.json
                parts = obj.object_name.split("/")
                if len(parts) >= 2 and parts[0] == "skills":
                    skill_ids.add(parts[1])
            return list(skill_ids)
        except S3Error as e:
            print(f"Error listing skills: {e}")
            return []

    def create_backup(self, skill_id: str, backup_type: str = "daily") -> str:
        """åˆ›å»ºæŠ€èƒ½å¤‡ä»½"""
        storage = self.create_skill_storage(skill_id)
        backup_id = f"{backup_type}_{datetime.utcnow().strftime('%Y%m%d_%H%M%S')}"

        # å¤åˆ¶æ‰€æœ‰æ–‡ä»¶åˆ°archivesæ¡¶
        files = storage.list_files()
        for file_path in files:
            source = CopySource(
                bucket_name=storage.skills_bucket,
                object_name=file_path
            )
            backup_object_name = f"backups/{skill_id}/{backup_id}/{file_path.split('/', 1)[1]}"

            self.client.copy_object(
                bucket_name=self.buckets["archives"],
                object_name=backup_object_name,
                source=source
            )

        return backup_id

class SkillStorage:
    """æŠ€èƒ½å­˜å‚¨å®ä¾‹ï¼ˆMinIOå®ç°ï¼‰"""

    def __init__(self, client: Minio, buckets: Dict[str, str], skill_id: str):
        self.client = client
        self.buckets = buckets
        self.skill_id = skill_id
        self.skills_bucket = buckets["skills"]

    def upload_file(self, object_name: str, file_data: bytes, content_type: str = "application/octet-stream"):
        """ä¸Šä¼ æ–‡ä»¶åˆ°MinIO"""
        full_object_name = f"skills/{self.skill_id}/{object_name}"

        try:
            # ä½¿ç”¨BytesIOå°†å­—èŠ‚æ•°æ®è½¬æ¢ä¸ºæ–‡ä»¶-likeå¯¹è±¡
            file_obj = io.BytesIO(file_data)
            file_obj.seek(0)

            self.client.put_object(
                bucket_name=self.skills_bucket,
                object_name=full_object_name,
                data=file_obj,
                length=len(file_data),
                content_type=content_type
            )
        except S3Error as e:
            raise Exception(f"Failed to upload file {object_name}: {e}")

    def download_file(self, object_name: str) -> bytes:
        """ä»MinIOä¸‹è½½æ–‡ä»¶"""
        full_object_name = f"skills/{self.skill_id}/{object_name}"

        try:
            response = self.client.get_object(
                bucket_name=self.skills_bucket,
                object_name=full_object_name
            )
            data = response.read()
            response.close()
            response.release_conn()
            return data
        except S3Error as e:
            raise Exception(f"Failed to download file {object_name}: {e}")

    def list_files(self, prefix: str = "") -> List[str]:
        """åˆ—å‡ºæŠ€èƒ½ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"""
        full_prefix = f"skills/{self.skill_id}/{prefix}"

        try:
            objects = self.client.list_objects(
                bucket_name=self.skills_bucket,
                prefix=full_prefix,
                recursive=True
            )
            return [obj.object_name for obj in objects]
        except S3Error as e:
            raise Exception(f"Failed to list files: {e}")

    def delete_file(self, object_name: str):
        """åˆ é™¤å•ä¸ªæ–‡ä»¶"""
        full_object_name = f"skills/{self.skill_id}/{object_name}"

        try:
            self.client.remove_object(
                bucket_name=self.skills_bucket,
                object_name=full_object_name
            )
        except S3Error as e:
            raise Exception(f"Failed to delete file {object_name}: {e}")

    def delete_all_files(self):
        """åˆ é™¤æŠ€èƒ½ä¸‹çš„æ‰€æœ‰æ–‡ä»¶"""
        try:
            objects = self.client.list_objects(
                bucket_name=self.skills_bucket,
                prefix=f"skills/{self.skill_id}/",
                recursive=True
            )

            for obj in objects:
                self.client.remove_object(
                    bucket_name=self.skills_bucket,
                    object_name=obj.object_name
                )
        except S3Error as e:
            raise Exception(f"Failed to delete skill files: {e}")

    def get_file_url(self, object_name: str, expires_hours: int = 24) -> str:
        """è·å–æ–‡ä»¶çš„ä¸´æ—¶è®¿é—®URL"""
        full_object_name = f"skills/{self.skill_id}/{object_name}"

        try:
            url = self.client.presigned_get_object(
                bucket_name=self.skills_bucket,
                object_name=full_object_name,
                expires=expires_hours * 3600  # è½¬æ¢ä¸ºç§’
            )
            return url
        except S3Error as e:
            raise Exception(f"Failed to get file URL: {e}")

    def move_file(self, source_object_name: str, dest_object_name: str):
        """ç§»åŠ¨/é‡å‘½åæ–‡ä»¶"""
        try:
            # å¤åˆ¶åˆ°æ–°ä½ç½®
            source = CopySource(
                bucket_name=self.skills_bucket,
                object_name=f"skills/{self.skill_id}/{source_object_name}"
            )

            self.client.copy_object(
                bucket_name=self.skills_bucket,
                object_name=f"skills/{self.skill_id}/{dest_object_name}",
                source=source
            )

            # åˆ é™¤åŸæ–‡ä»¶
            self.client.remove_object(
                bucket_name=self.skills_bucket,
                object_name=f"skills/{self.skill_id}/{source_object_name}"
            )
        except S3Error as e:
            raise Exception(f"Failed to move file: {e}")

    def get_file_info(self, object_name: str) -> Dict[str, Any]:
        """è·å–æ–‡ä»¶ä¿¡æ¯"""
        full_object_name = f"skills/{self.skill_id}/{object_name}"

        try:
            stat = self.client.stat_object(
                bucket_name=self.skills_bucket,
                object_name=full_object_name
            )
            return {
                "size": stat.size,
                "content_type": stat.content_type,
                "etag": stat.etag,
                "last_modified": stat.last_modified,
                "metadata": stat.metadata
            }
        except S3Error as e:
            raise Exception(f"Failed to get file info: {e}")
```

#### 3.2 æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ

```python
# src/storage/versioning.py
import json
from datetime import datetime
from typing import Dict, List, Optional
from .manager import SkillStorage

class VersionManager:
    """æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†å™¨"""

    def __init__(self, storage: SkillStorage):
        self.storage = storage
        self.versions_bucket = "skillseekers-versions"

    def create_version(self, file_path: str, file_data: bytes,
                      content_type: str = "application/octet-stream",
                      comment: str = "") -> str:
        """åˆ›å»ºæ–‡ä»¶æ–°ç‰ˆæœ¬"""
        version_id = datetime.utcnow().strftime("%Y%m%d_%H%M%S_%f")
        version_object_name = f"versions/{self.storage.skill_id}/{file_path}/{version_id}"

        # åˆ›å»ºç‰ˆæœ¬ä¿¡æ¯
        version_info = {
            "version_id": version_id,
            "file_path": file_path,
            "created_at": datetime.utcnow().isoformat(),
            "content_type": content_type,
            "comment": comment,
            "size": len(file_data)
        }

        try:
            # ä¸Šä¼ ç‰ˆæœ¬æ–‡ä»¶
            file_obj = io.BytesIO(file_data)
            file_obj.seek(0)

            self.storage.client.put_object(
                bucket_name=self.versions_bucket,
                object_name=version_object_name,
                data=file_obj,
                length=len(file_data),
                content_type=content_type
            )

            # ä¿å­˜ç‰ˆæœ¬ä¿¡æ¯
            info_object_name = version_object_name + "/_info.json"
            info_data = json.dumps(version_info, indent=2).encode('utf-8')

            info_obj = io.BytesIO(info_data)
            info_obj.seek(0)

            self.storage.client.put_object(
                bucket_name=self.versions_bucket,
                object_name=info_object_name,
                data=info_obj,
                length=len(info_data),
                content_type="application/json"
            )

            return version_id
        except S3Error as e:
            raise Exception(f"Failed to create version: {e}")

    def list_versions(self, file_path: str) -> List[Dict[str, Any]]:
        """åˆ—å‡ºæ–‡ä»¶çš„æ‰€æœ‰ç‰ˆæœ¬"""
        try:
            objects = self.storage.client.list_objects(
                bucket_name=self.versions_bucket,
                prefix=f"versions/{self.storage.skill_id}/{file_path}/",
                recursive=False
            )

            versions = []
            for obj in objects:
                if obj.object_name.endswith("/_info.json"):
                    # è¯»å–ç‰ˆæœ¬ä¿¡æ¯
                    response = self.storage.client.get_object(
                        bucket_name=self.versions_bucket,
                        object_name=obj.object_name
                    )
                    info_data = json.loads(response.read().decode('utf-8'))
                    versions.append(info_data)
                    response.close()
                    response.release_conn()

            # æŒ‰åˆ›å»ºæ—¶é—´æ’åº
            versions.sort(key=lambda x: x["created_at"], reverse=True)
            return versions
        except S3Error as e:
            raise Exception(f"Failed to list versions: {e}")

    def restore_version(self, file_path: str, version_id: str) -> bytes:
        """æ¢å¤æ–‡ä»¶åˆ°æŒ‡å®šç‰ˆæœ¬"""
        version_object_name = f"versions/{self.storage.skill_id}/{file_path}/{version_id}"

        try:
            response = self.storage.client.get_object(
                bucket_name=self.versions_bucket,
                object_name=version_object_name
            )
            data = response.read()
            response.close()
            response.release_conn()
            return data
        except S3Error as e:
            raise Exception(f"Failed to restore version: {e}")
```

#### 3.3 ç¼“å­˜ç®¡ç†ç³»ç»Ÿ

```python
# src/storage/cache.py
import hashlib
import json
from typing import Any, Optional
from datetime import datetime, timedelta
from .manager import SkillStorage

class CacheManager:
    """MinIOç¼“å­˜ç®¡ç†å™¨"""

    def __init__(self, storage: SkillStorage):
        self.storage = storage
        self.cache_bucket = self.storage.buckets["cache"]
        self.default_ttl = 3600  # 1å°æ—¶

    def _generate_cache_key(self, key: str) -> str:
        """ç”Ÿæˆç¼“å­˜é”®"""
        return hashlib.md5(key.encode()).hexdigest()

    def get(self, key: str) -> Optional[Any]:
        """è·å–ç¼“å­˜æ•°æ®"""
        cache_key = self._generate_cache_key(key)
        cache_object_name = f"cache/{cache_key}"

        try:
            response = self.storage.client.get_object(
                bucket_name=self.cache_bucket,
                object_name=cache_object_name
            )

            data = response.read().decode('utf-8')
            cache_info = json.loads(data)

            # æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
            if datetime.fromisoformat(cache_info["expires_at"]) > datetime.utcnow():
                return cache_info["data"]
            else:
                # åˆ é™¤è¿‡æœŸç¼“å­˜
                self.storage.client.remove_object(
                    bucket_name=self.cache_bucket,
                    object_name=cache_object_name
                )
                return None

        except S3Error:
            return None

    def set(self, key: str, value: Any, ttl: int = None) -> None:
        """è®¾ç½®ç¼“å­˜æ•°æ®"""
        ttl = ttl or self.default_ttl

        cache_key = self._generate_cache_key(key)
        cache_object_name = f"cache/{cache_key}"

        expires_at = datetime.utcnow() + timedelta(seconds=ttl)

        cache_data = {
            "key": key,
            "data": value,
            "created_at": datetime.utcnow().isoformat(),
            "expires_at": expires_at.isoformat()
        }

        try:
            cache_json = json.dumps(cache_data, default=str).encode('utf-8')

            cache_obj = io.BytesIO(cache_json)
            cache_obj.seek(0)

            self.storage.client.put_object(
                bucket_name=self.cache_bucket,
                object_name=cache_object_name,
                data=cache_obj,
                length=len(cache_json),
                content_type="application/json"
            )
        except S3Error as e:
            raise Exception(f"Failed to set cache: {e}")

    def delete(self, key: str) -> None:
        """åˆ é™¤ç¼“å­˜"""
        cache_key = self._generate_cache_key(key)
        cache_object_name = f"cache/{cache_key}"

        try:
            self.storage.client.remove_object(
                bucket_name=self.cache_bucket,
                object_name=cache_object_name
            )
        except S3Error:
            pass

    def clear_expired(self) -> int:
        """æ¸…ç†è¿‡æœŸç¼“å­˜"""
        try:
            objects = self.storage.client.list_objects(
                bucket_name=self.cache_bucket,
                prefix="cache/",
                recursive=True
            )

            deleted_count = 0
            current_time = datetime.utcnow()

            for obj in objects:
                if obj.object_name.endswith("/_info.json"):
                    continue

                try:
                    response = self.storage.client.get_object(
                        bucket_name=self.cache_bucket,
                        object_name=obj.object_name
                    )

                    data = json.loads(response.read().decode('utf-8'))
                    expires_at = datetime.fromisoformat(data["expires_at"])

                    if expires_at <= current_time:
                        self.storage.client.remove_object(
                            bucket_name=self.cache_bucket,
                            object_name=obj.object_name
                        )
                        deleted_count += 1

                    response.close()
                    response.release_conn()
                except:
                    continue

            return deleted_count
        except S3Error as e:
            raise Exception(f"Failed to clear expired cache: {e}")
```

### ç¬¬å››é˜¶æ®µï¼šDocker éƒ¨ç½²æ–¹æ¡ˆï¼ˆ3-4å‘¨ï¼‰

#### 4.1 Docker Compose é…ç½®

```yaml
# docker-compose.yml
version: '3.8'

services:
  # å‰ç«¯Webç•Œé¢ï¼ˆé€šè¿‡Nginxæ‰˜ç®¡ï¼‰
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    # ä¸æš´éœ²ç«¯å£ï¼Œç”±Nginxç»Ÿä¸€å¯¹å¤–æœåŠ¡
    environment:
      - REACT_APP_API_URL=/api
      - REACT_APP_WS_URL=/ws
      - REACT_APP_MINIO_ENDPOINT=/minio
    depends_on:
      - backend
    restart: unless-stopped
    networks:
      - skillseekers

  # åç«¯APIæœåŠ¡
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/skillseekers
      - REDIS_URL=redis://redis:6379/0
      - MINIO_ENDPOINT=minio:9000
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin123
      - MINIO_SECURE=false
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - GITHUB_TOKEN=${GITHUB_TOKEN}
    volumes:
      - ./skill-seekers:/usr/local/bin/skill-seekers:ro
    depends_on:
      - postgres
      - redis
      - minio
    restart: unless-stopped
    networks:
      - skillseekers

  # MinIOå¯¹è±¡å­˜å‚¨
  minio:
    image: minio/minio:latest
    ports:
      - "9000:9000"
      - "9001:9001"
    environment:
      - MINIO_ROOT_USER=minioadmin
      - MINIO_ROOT_PASSWORD=minioadmin123
      - MINIO_CONSOLE_ADDRESS=:9001
    command: server /data --console-address ":9001"
    volumes:
      - minio_data:/data
    restart: unless-stopped
    networks:
      - skillseekers

  # MinIOå®¢æˆ·ç«¯ï¼ˆç”¨äºåˆå§‹åŒ–ï¼‰
  minio-setup:
    image: minio/mc:latest
    depends_on:
      - minio
    entrypoint: >
      /bin/sh -c "
      sleep 5;
      mc alias set local http://minio:9000 minioadmin minioadmin123;
      mc mb --ignore-existing local/skillseekers-skills;
      mc mb --ignore-existing local/skillseekers-temp;
      mc mb --ignore-existing local/skillseekers-cache;
      mc mb --ignore-existing local/skillseekers-archives;
      mc policy set public local/skillseekers-skills;
      exit 0;
      "

  # Celery Workerï¼ˆåå°ä»»åŠ¡å¤„ç†ï¼‰
  worker:
    build:
      context: ./backend
      dockerfile: Dockerfile.worker
    command: celery -A src.tasks.celery worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://postgres:password@postgres:5432/skillseekers
      - REDIS_URL=redis://redis:6379/0
      - MINIO_ENDPOINT=minio:9000
      - MINIO_ACCESS_KEY=minioadmin
      - MINIO_SECRET_KEY=minioadmin123
      - MINIO_SECURE=false
    volumes:
      - ./skill-seekers:/usr/local/bin/skill-seekers:ro
    depends_on:
      - postgres
      - redis
      - minio
    restart: unless-stopped
    networks:
      - skillseekers

  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    environment:
      - POSTGRES_DB=skillseekers
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    restart: unless-stopped
    networks:
      - skillseekers

  # Redisç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—
  redis:
    image: redis:7-alpine
    command: redis-server --appendonly yes --requirepass redispassword
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"
    restart: unless-stopped
    networks:
      - skillseekers

  # Nginxåå‘ä»£ç†ï¼ˆç»Ÿä¸€å¯¹å¤–å…¥å£ï¼‰
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./frontend/dist:/usr/share/nginx/html:ro
    depends_on:
      - frontend
      - backend
      - minio
    restart: unless-stopped
    networks:
      - skillseekers

volumes:
  postgres_data:
  redis_data:
  minio_data:

networks:
  skillseekers:
    driver: bridge
```

#### 4.2 MinIOé…ç½®æ–‡ä»¶

```yaml
# nginx/nginx.conf - ç»Ÿä¸€åå‘ä»£ç†é…ç½®

# å…¨å±€é…ç½®
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;

# äº‹ä»¶æ¨¡å—
events {
    worker_connections 1024;
    use epoll;
    multi_accept on;
}

http {
    # åŸºç¡€é…ç½®
    include /etc/nginx/mime.types;
    default_type application/octet-stream;
    charset UTF-8;

    # æ—¥å¿—æ ¼å¼
    log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                    '$status $body_bytes_sent "$http_referer" '
                    '"$http_user_agent" "$http_x_forwarded_for" '
                    'rt=$request_time uct="$upstream_connect_time" '
                    'uht="$upstream_header_time" urt="$upstream_response_time"';

    access_log /var/log/nginx/access.log main;

    # æ€§èƒ½ä¼˜åŒ–
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    keepalive_requests 1000;
    types_hash_max_size 2048;
    server_tokens off;

    # Gzipå‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1000;
    gzip_proxied any;
    gzip_comp_level 6;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        text/x-component
        application/javascript
        application/json
        application/xml
        application/rss+xml
        application/atom+xml
        font/truetype
        font/opentype
        application/vnd.ms-fontobject
        image/svg+xml;

    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' http: data: blob: 'unsafe-inline'" always;

    # è¯·æ±‚é™åˆ¶
    client_max_body_size 100M;
    client_body_timeout 60s;
    client_header_timeout 60s;

    # ä¸Šæ¸¸æœåŠ¡å™¨é…ç½®
    upstream backend {
        server backend:8000 max_fails=3 fail_timeout=30s;
        keepalive 32;
    }

    upstream minio {
        server minio:9000 max_fails=3 fail_timeout=30s;
    }

    # HTTPæœåŠ¡å™¨é…ç½®
    server {
        listen 80;
        server_name localhost;
        root /usr/share/nginx/html;
        index index.html;

        # å¥åº·æ£€æŸ¥ç«¯ç‚¹
        location /health {
            access_log off;
            return 200 "healthy\n";
            add_header Content-Type text/plain;
        }

        # å‰ç«¯é™æ€æ–‡ä»¶
        location / {
            try_files $uri $uri/ /index.html;

            # é™æ€æ–‡ä»¶ç¼“å­˜
            location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
                expires 1y;
                add_header Cache-Control "public, immutable";
                access_log off;
            }

            # HTMLæ–‡ä»¶ä¸ç¼“å­˜
            location ~* \.html$ {
                add_header Cache-Control "no-cache, no-store, must-revalidate";
                add_header Pragma "no-cache";
                add_header Expires "0";
            }
        }

        # APIä»£ç†
        location /api/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # è¶…æ—¶è®¾ç½®
            proxy_connect_timeout 60s;
            proxy_send_timeout 60s;
            proxy_read_timeout 60s;

            # ç¼“å†²è®¾ç½®
            proxy_buffering on;
            proxy_buffer_size 4k;
            proxy_buffers 8 4k;
        }

        # WebSocketä»£ç†
        location /ws/ {
            proxy_pass http://backend;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # WebSocketç‰¹å®šè¶…æ—¶
            proxy_read_timeout 86400s;
            proxy_send_timeout 86400s;
        }

        # MinIO APIä»£ç†
        location /minio/ {
            proxy_pass http://minio;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;

            # é™åˆ¶HTTPæ–¹æ³•ï¼ˆä»…GETï¼‰
            limit_except GET {
                deny all;
            }

            # å¢åŠ ä»£ç†ç¼“å†²
            proxy_buffering off;
            proxy_request_buffering off;
        }

        # MinIOæ§åˆ¶å°ä»£ç†
        location /minio-console/ {
            proxy_pass http://minio:9001/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # MinIOç®¡ç†æ§åˆ¶å°ï¼ˆå‹å¥½è·¯å¾„ï¼‰
        location /minio/ {
            proxy_pass http://minio:9001/;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # é”™è¯¯é¡µé¢
        error_page 404 /404.html;
        error_page 500 502 503 504 /50x.html;

        location = /50x.html {
            root /usr/share/nginx/html;
        }
    }
}
```

### ç¬¬äº”é˜¶æ®µï¼šæµ‹è¯•ä¸ä¼˜åŒ–ï¼ˆ3-4å‘¨ï¼‰

#### 5.1 MinIOå­˜å‚¨æµ‹è¯•

```python
# tests/test_storage.py
import pytest
from minio.error import S3Error
from src.storage.manager import SkillStorageManager, SkillStorage

class TestMinIOStorage:
    """MinIOå­˜å‚¨æµ‹è¯•"""

    @pytest.fixture
    def storage_manager(self):
        """åˆ›å»ºå­˜å‚¨ç®¡ç†å™¨å®ä¾‹"""
        return SkillStorageManager(
            endpoint="localhost:9000",
            access_key="minioadmin",
            secret_key="minioadmin123",
            secure=False
        )

    @pytest.fixture
    def skill_storage(self, storage_manager):
        """åˆ›å»ºæŠ€èƒ½å­˜å‚¨å®ä¾‹"""
        skill_id = "test-skill-123"
        return storage_manager.create_skill_storage(skill_id)

    def test_upload_file(self, skill_storage):
        """æµ‹è¯•æ–‡ä»¶ä¸Šä¼ """
        file_data = b"Hello, MinIO!"
        object_name = "test.txt"

        skill_storage.upload_file(
            object_name=object_name,
            file_data=file_data,
            content_type="text/plain"
        )

        # éªŒè¯æ–‡ä»¶å­˜åœ¨
        files = skill_storage.list_files()
        assert f"skills/{skill_storage.skill_id}/{object_name}" in files

    def test_download_file(self, skill_storage):
        """æµ‹è¯•æ–‡ä»¶ä¸‹è½½"""
        file_data = b"Test file content"
        object_name = "test.txt"

        # ä¸Šä¼ æ–‡ä»¶
        skill_storage.upload_file(
            object_name=object_name,
            file_data=file_data
        )

        # ä¸‹è½½æ–‡ä»¶
        downloaded_data = skill_storage.download_file(object_name)
        assert downloaded_data == file_data

    def test_file_versioning(self, skill_storage):
        """æµ‹è¯•æ–‡ä»¶ç‰ˆæœ¬æ§åˆ¶"""
        from src.storage.versioning import VersionManager

        version_manager = VersionManager(skill_storage)

        # åˆ›å»ºç‰ˆæœ¬1
        file_data_v1 = b"Version 1"
        version_id_1 = version_manager.create_version(
            file_path="test.txt",
            file_data=file_data_v1,
            comment="Initial version"
        )

        # åˆ›å»ºç‰ˆæœ¬2
        file_data_v2 = b"Version 2"
        version_id_2 = version_manager.create_version(
            file_path="test.txt",
            file_data=file_data_v2,
            comment="Updated version"
        )

        # åˆ—å‡ºç‰ˆæœ¬
        versions = version_manager.list_versions("test.txt")
        assert len(versions) == 2
        assert version_id_1 in [v["version_id"] for v in versions]
        assert version_id_2 in [v["version_id"] for v in versions]

    def test_cache_operations(self, skill_storage):
        """æµ‹è¯•ç¼“å­˜æ“ä½œ"""
        from src.storage.cache import CacheManager

        cache_manager = CacheManager(skill_storage)

        # è®¾ç½®ç¼“å­˜
        cache_manager.set("test_key", {"data": "test_value"}, ttl=3600)

        # è·å–ç¼“å­˜
        cached_data = cache_manager.get("test_key")
        assert cached_data == {"data": "test_value"}

        # åˆ é™¤ç¼“å­˜
        cache_manager.delete("test_key")
        assert cache_manager.get("test_key") is None

    def test_skill_backup(self, storage_manager):
        """æµ‹è¯•æŠ€èƒ½å¤‡ä»½"""
        skill_id = "backup-test-skill"
        skill_storage = storage_manager.create_skill_storage(skill_id)

        # åˆ›å»ºæµ‹è¯•æ–‡ä»¶
        skill_storage.upload_file(
            object_name="test.txt",
            file_data=b"Test content"
        )

        # åˆ›å»ºå¤‡ä»½
        backup_id = storage_manager.create_backup(skill_id, "daily")

        # éªŒè¯å¤‡ä»½åˆ›å»º
        assert backup_id.startswith("daily_")
```

## MinIOå­˜å‚¨ä¼˜åŠ¿æ€»ç»“

### 1. é«˜æ€§èƒ½
- **å¹¶è¡Œä¸Šä¼ **ï¼šæ”¯æŒå¤šçº¿ç¨‹åŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶
- **CDNé›†æˆ**ï¼šå…¨çƒå†…å®¹åˆ†å‘ç½‘ç»œæ”¯æŒ
- **æ™ºèƒ½ç¼“å­˜**ï¼šè‡ªåŠ¨ç¼“å­˜çƒ­é—¨æ–‡ä»¶

### 2. é«˜å¯é æ€§
- **æ•°æ®å†—ä½™**ï¼šè‡ªåŠ¨å¤šå‰¯æœ¬å­˜å‚¨
- **ç‰ˆæœ¬æ§åˆ¶**ï¼šå®Œæ•´çš„æ–‡ä»¶å†å²ç‰ˆæœ¬ç®¡ç†
- **æ•…éšœæ¢å¤**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œæ¢å¤æŸåæ•°æ®

### 3. æˆæœ¬ä¼˜åŒ–
- **å‹ç¼©å­˜å‚¨**ï¼šè‡ªåŠ¨å‹ç¼©å‡å°‘å­˜å‚¨æˆæœ¬
- **åˆ†å±‚å­˜å‚¨**ï¼šæ ¹æ®è®¿é—®é¢‘ç‡è‡ªåŠ¨åˆ†å±‚
- **ç”Ÿå‘½å‘¨æœŸç®¡ç†**ï¼šè‡ªåŠ¨å½’æ¡£å’Œåˆ é™¤è¿‡æœŸæ•°æ®

### 4. æ˜“äºç®¡ç†
- **Webç®¡ç†ç•Œé¢**ï¼šç›´è§‚çš„MinIOæ§åˆ¶å°
- **APIé©±åŠ¨**ï¼šå®Œæ•´çš„REST APIæ”¯æŒ
- **å¥åº·æ£€æŸ¥**ï¼šå†…ç½®å¥åº·æ£€æŸ¥æ¥å£

## åŠŸèƒ½ç‰¹æ€§æ€»ç»“

### âœ… å·²å®ç°åŠŸèƒ½

1. **æŠ€èƒ½ç®¡ç†**
   - æŠ€èƒ½åˆ—è¡¨å±•ç¤ºï¼ˆå¡ç‰‡å¼å¸ƒå±€ï¼‰
   - MinIOå­˜å‚¨çŠ¶æ€æ˜¾ç¤º
   - æ–‡ä»¶å¤§å°å’Œæ•°é‡ç»Ÿè®¡
   - æŠ€èƒ½åˆ é™¤ï¼ˆå®‰å…¨åˆ é™¤ï¼‰

2. **MinIOå­˜å‚¨**
   - é«˜æ€§èƒ½å¯¹è±¡å­˜å‚¨
   - ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
   - æ™ºèƒ½ç¼“å­˜ç®¡ç†
   - è‡ªåŠ¨å¤‡ä»½æœºåˆ¶

3. **æ–‡ä»¶æ“ä½œ**
   - å®æ—¶ä¸Šä¼ ä¸‹è½½
   - ç‰ˆæœ¬å†å²æŸ¥çœ‹
   - æ–‡ä»¶é¢„è§ˆæ”¯æŒ
   - æ‰¹é‡æ“ä½œ

4. **å¤šå¹³å°æ”¯æŒ**
   - 4ä¸ªLLMå¹³å°ï¼ˆClaudeã€Geminiã€OpenAIã€Markdownï¼‰
   - å¹³å°ä¸“å±æ‰“åŒ…æ ¼å¼
   - è·¨å¹³å°å…¼å®¹æ€§

5. **å®æ—¶ä½“éªŒ**
   - WebSocketå®æ—¶è¿›åº¦æ¨é€
   - åˆ›å»ºè¿‡ç¨‹æ—¥å¿—æŸ¥çœ‹
   - æ–‡ä»¶æ“ä½œå®æ—¶åé¦ˆ

6. **å­˜å‚¨æ¶æ„**
   - MinIOå¯¹è±¡å­˜å‚¨
   - PostgreSQLå…ƒæ•°æ®
   - Redisç¼“å­˜åŠ é€Ÿ
   - åˆ†å±‚å­˜å‚¨ç­–ç•¥

7. **éƒ¨ç½²æ–¹æ¡ˆ**
   - Dockerå®¹å™¨åŒ–
   - MinIOé›†ç¾¤éƒ¨ç½²
   - ä¸€é”®éƒ¨ç½²è„šæœ¬
   - ç”Ÿäº§çº§é…ç½®

### ğŸ¯ æŠ€æœ¯äº®ç‚¹

1. **ç°ä»£åŒ–å­˜å‚¨**
   - MinIOå¯¹è±¡å­˜å‚¨
   - æ— é™æ°´å¹³æ‰©å±•
   - ä¼ä¸šçº§å¯é æ€§
   - æˆæœ¬ä¼˜åŒ–å­˜å‚¨

2. **ç”¨æˆ·ä½“éªŒä¼˜åŒ–**
   - å®æ—¶æ–‡ä»¶æ“ä½œåé¦ˆ
   - å­˜å‚¨çŠ¶æ€å¯è§†åŒ–
   - ç‰ˆæœ¬å†å²ç®¡ç†
   - æ™ºèƒ½ç¼“å­˜åŠ é€Ÿ

3. **å¯æ‰©å±•æ¶æ„**
   - å¾®æœåŠ¡å‹å¥½
   - APIé©±åŠ¨è®¾è®¡
   - æ’ä»¶åŒ–æ”¯æŒ
   - äº‘åŸç”Ÿéƒ¨ç½²

4. **ç”Ÿäº§å°±ç»ª**
   - é«˜å¯ç”¨éƒ¨ç½²
   - å¥åº·æ£€æŸ¥
   - æ•°æ®å¤‡ä»½
   - ç®€åŒ–è¿ç»´

5. **ç®€åŒ–è®¾è®¡**
   - æ— éœ€ç”¨æˆ·ç®¡ç†
   - å•ç§Ÿæˆ·æ¶æ„
   - å¿«é€ŸMVPäº¤ä»˜
   - é™ä½è¿ç»´æˆæœ¬

6. **ç»Ÿä¸€æ¥å…¥**
   - Nginxåå‘ä»£ç†
   - é™æ€æ–‡ä»¶æ‰˜ç®¡
   - APIç»Ÿä¸€è½¬å‘
   - ç®€åŒ–HTTPé…ç½®

## å¼€å‘æ—¶é—´çº¿

| é˜¶æ®µ | æ—¶é—´ | ä¸»è¦ä»»åŠ¡ |
|------|------|----------|
| **é˜¶æ®µ1** | 3-4å‘¨ | æ•°æ®åº“è®¾è®¡ã€FastAPIåç«¯ã€Celeryä»»åŠ¡é˜Ÿåˆ— |
| **é˜¶æ®µ2** | 6-8å‘¨ | Reactå‰ç«¯ã€ç»„ä»¶å¼€å‘ã€ç•Œé¢é›†æˆ |
| **é˜¶æ®µ3** | 4-5å‘¨ | MinIOå­˜å‚¨ç³»ç»Ÿã€ç¼“å­˜ç®¡ç†ã€ç‰ˆæœ¬æ§åˆ¶ |
| **é˜¶æ®µ4** | 3-4å‘¨ | Dockeréƒ¨ç½²ã€MinIOé›†ç¾¤ã€éƒ¨ç½²è„šæœ¬ |
| **é˜¶æ®µ5** | 3-4å‘¨ | æµ‹è¯•ã€è°ƒè¯•ã€æ€§èƒ½ä¼˜åŒ–ã€æ–‡æ¡£ |

**æ€»è®¡ï¼š10-12ä¸ªæœˆ**ï¼ˆå»é™¤ç”¨æˆ·ç®¡ç†åŠŸèƒ½ï¼Œç®€åŒ–éƒ¨ç½²æ¶æ„ï¼‰

## å¿«é€Ÿå¯åŠ¨

```bash
# 1. å…‹éš†é¡¹ç›®
git clone skillseekers-web-minio
cd skillseekers-web-minio

# 2. ä¸€é”®éƒ¨ç½²
chmod +x deploy.sh
./deploy.sh

# 3. è®¿é—®Webç•Œé¢ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
open http://localhost
# - å‰ç«¯: http://localhost/
# - API: http://localhost/api/
# - WebSocket: ws://localhost/ws/
# - MinIOæ§åˆ¶å°: http://localhost/minio-console/

# 4. æ— éœ€ç™»å½•ï¼Œç›´æ¥ä½¿ç”¨æ‰€æœ‰åŠŸèƒ½
```

**æ³¨æ„**ï¼šç³»ç»Ÿé‡‡ç”¨å•ç§Ÿæˆ·æ¶æ„ï¼Œæ— ç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚æ‰€æœ‰è®¿é—®è€…å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰€æœ‰æŠ€èƒ½ç®¡ç†åŠŸèƒ½ã€‚

**æœªæ¥æ‰©å±•**ï¼šç”Ÿäº§ç¯å¢ƒä¸­å¯åæœŸæ·»åŠ ç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
- ç”¨æˆ·æ³¨å†Œ/ç™»å½•
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶
- å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»
- ç”¨æˆ·é…é¢ç®¡ç†
- å®¡è®¡æ—¥å¿—è¿½è¸ª

**ç›‘æ§è¯´æ˜**ï¼šå¼€å‘é˜¶æ®µä¸è€ƒè™‘å¤æ‚çš„ç›‘æ§ç³»ç»Ÿï¼Œä»…ä¿ç•™åŸºæœ¬çš„å¥åº·æ£€æŸ¥å’Œæ—¥å¿—åŠŸèƒ½ã€‚

**HTTPSè¯´æ˜**ï¼šå¼€å‘é˜¶æ®µä½¿ç”¨HTTPåè®®ï¼Œç”Ÿäº§ç¯å¢ƒå¯æ ¹æ®éœ€è¦é…ç½®HTTPSã€‚Nginxå·²é¢„ç•™HTTPSé…ç½®æ‰©å±•ã€‚

### ç®€åŒ–æ¶æ„ä¼˜åŠ¿

**å»é™¤ç›‘æ§çš„ä¼˜åŠ¿**ï¼š
- é™ä½ç³»ç»Ÿå¤æ‚åº¦
- å‡å°‘èµ„æºæ¶ˆè€—
- åŠ å¿«éƒ¨ç½²é€Ÿåº¦
- é™ä½è¿ç»´æˆæœ¬
- ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½å¼€å‘

### Nginxç»Ÿä¸€è½¬å‘æ¶æ„

**å‰ç«¯é…ç½®**ï¼š
- ç¯å¢ƒå˜é‡ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼ˆ`/api`, `/ws`, `/minio`ï¼‰
- é™æ€æ–‡ä»¶ç”±Nginxç›´æ¥æ‰˜ç®¡
- å‰åç«¯é€šè¿‡ç»Ÿä¸€å…¥å£è®¿é—®

**NginxåŠŸèƒ½**ï¼š
- é™æ€æ–‡ä»¶æ‰˜ç®¡å’Œç¼“å­˜
- APIè¯·æ±‚åå‘ä»£ç†åˆ°åç«¯
- WebSocketè¿æ¥å‡çº§è½¬å‘
- MinIO APIå’Œæ§åˆ¶å°ä»£ç†
- HTTPå‹ç¼©ä¼˜åŒ–
- å®‰å…¨å¤´å’Œè®¿é—®æ§åˆ¶

## MinIO vs æ–‡ä»¶ç³»ç»Ÿå¯¹æ¯”

| ç‰¹æ€§ | MinIO | æ–‡ä»¶ç³»ç»Ÿ |
|------|-------|----------|
| **æ‰©å±•æ€§** | æ— é™æ°´å¹³æ‰©å±• | å—é™äºå•æœº |
| **å¯ç”¨æ€§** | 99.9%+ | å–å†³äºç¡¬ä»¶ |
| **æ€§èƒ½** | é«˜å¹¶å‘ä¼˜åŒ– | å—é™äºç£ç›˜ |
| **æˆæœ¬** | æŒ‰éœ€æ‰©å±• | å›ºå®šæŠ•å…¥ |
| **ç»´æŠ¤** | ç®€å•è‡ªåŠ¨åŒ– | å¤æ‚è¿ç»´ |
| **åŠŸèƒ½** | ç‰ˆæœ¬æ§åˆ¶+API | åŸºç¡€å­˜å‚¨ |

## ç»“è¯­

æœ¬å®æ–½æ–¹æ¡ˆåŸºäºç°æœ‰çš„skill_seekers CLIå·¥å…·ï¼Œé€šè¿‡ç°ä»£åŒ–çš„Webç•Œé¢ã€MinIOå¯¹è±¡å­˜å‚¨å’Œé«˜å¯ç”¨æ¶æ„è®¾è®¡ï¼Œå®Œæ•´å®ç°äº†ã€ŠCOMPLETE_REQUIREMENTS.mdã€‹ä¸­çš„æ‰€æœ‰åŠŸèƒ½éœ€æ±‚ã€‚

### ä¼˜åŠ¿

- **æŠ€æœ¯å…ˆè¿›**ï¼šMinIOå¯¹è±¡å­˜å‚¨ï¼Œä¼ä¸šçº§å¯é æ€§
- **æ€§èƒ½ä¼˜å¼‚**ï¼šé«˜å¹¶å‘ã€æ°´å¹³æ‰©å±•ã€æ™ºèƒ½ç¼“å­˜
- **è¿ç»´ç®€å•**ï¼šè‡ªåŠ¨åŒ–ç®¡ç†ã€æ—¥å¿—æŸ¥çœ‹
- **æˆæœ¬ä¼˜åŒ–**ï¼šæŒ‰éœ€æ‰©å±•ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
- **ç”¨æˆ·ä½“éªŒ**ï¼šå®æ—¶æ“ä½œåé¦ˆã€ç‰ˆæœ¬ç®¡ç†
- **å¼€å‘é«˜æ•ˆ**ï¼šæ— éœ€ç”¨æˆ·ç®¡ç†ï¼Œä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½

### äº¤ä»˜ç‰©

- âœ… å®Œæ•´çš„Webç®¡ç†ç³»ç»Ÿï¼ˆæ— ç”¨æˆ·ç®¡ç†ï¼‰
- âœ… MinIOå¯¹è±¡å­˜å‚¨æ–¹æ¡ˆ
- âœ… æºä»£ç å’Œæ–‡æ¡£
- âœ… Dockeréƒ¨ç½²æ–¹æ¡ˆ
- âœ… æµ‹è¯•ç”¨ä¾‹å’ŒCI/CD
- âœ… ç³»ç»Ÿä½¿ç”¨æŒ‡å—ï¼ˆæ— éœ€ç™»å½•ï¼‰

é€šè¿‡è¿™ä¸ªå®æ–½æ–¹æ¡ˆï¼Œskill_seekerså°†ä»å‘½ä»¤è¡Œå·¥å…·å‡çº§ä¸ºåŠŸèƒ½å®Œæ•´çš„ä¼ä¸šçº§æŠ€èƒ½ç®¡ç†ç³»ç»Ÿï¼Œä¸ºæ‰€æœ‰è®¿é—®è€…æä¾›æ›´å¥½çš„ä½¿ç”¨ä½“éªŒå’Œæ›´é«˜çš„å¼€å‘æ•ˆç‡ã€‚
